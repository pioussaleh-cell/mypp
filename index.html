<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TemanQu - Sahabat Perjalanan Jiwa</title>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;800&family=Patrick+Hand&display=swap" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Tailwind Config for Dark Mode -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Outfit', 'sans-serif'],
                        hand: ['Patrick Hand', 'cursive'],
                    }
                }
            }
        }
    </script>

    <!-- Dependencies -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        body { 
            font-family: 'Outfit', sans-serif; 
            -webkit-tap-highlight-color: transparent;
            transition: background-color 0.4s ease;
        }
        .font-handwriting {
            font-family: 'Patrick Hand', cursive;
        }
        .prose p { margin: 0; }
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        @keyframes slide-up {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .animate-in {
            animation: slide-up 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-[#F0F4F3] text-slate-800 transition-colors duration-500">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- ICON COMPONENT ---
        const Icon = ({ name, ...props }) => {
            const Svg = ({ children, ...p }) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={p.size || 24} height={p.size || 24} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth={p.strokeWidth || 2} strokeLinecap="round" strokeLinejoin="round" className={p.className}>{children}</svg>
            );
            const icons = {
                Home: <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />,
                Smile: <><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9"/></>,
                CheckCircle: <><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></>,
                ShieldCheck: <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10zM9 12l2 2 4-4" />,
                BookOpen: <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2zM22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" />,
                Settings: <><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></>,
                Moon: <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z" />,
                Sun: <><circle cx="12" cy="12" r="4"/><path d="M12 2v2m0 16v2M4.93 4.93l1.41 1.41m11.32 11.32l1.41 1.41M2 12h2m16 0h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/></>,
                Camera: <><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></>,
                Trash2: <path d="M3 6h18M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2M10 11v6M14 11v6" />,
                ShieldAlert: <><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></>,
                MapPin: <><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></>,
                Plus: <><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></>,
                LogOut: <><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></>,
                Save: <><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></>,
                RotateCcw: <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L1 8m0 0V3m0 5h5" />,
                Trophy: <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6M18 9h1.5a2.5 2.5 0 0 0 0-5H18M4 22h16M12 5v17" />,
                Lock: <><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></>,
                Unlock: <><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 9.9-1"/></>,
                RefreshCw: <path d="M21 2v6h-6M3 12a9 9 0 0 1 15-6.7L21 8M3 22v-6h6M21 12a9 9 0 0 1-15 6.7L3 16" />,
                User: <><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></>,
                Key: <path d="m21 2-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0 3 3L22 7l-3-3L15.5 7.5z" />,
                LinkIcon: <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" />,
                Timer: <><line x1="10" y1="2" x2="14" y2="2"/><line x1="12" y1="14" x2="15" y2="11"/><circle cx="12" cy="14" r="8"/></>,
                GripVertical: <><circle cx="9" cy="5" r="1"/><circle cx="9" cy="12" r="1"/><circle cx="9" cy="19" r="1"/><circle cx="15" cy="5" r="1"/><circle cx="15" cy="12" r="1"/><circle cx="15" cy="19" r="1"/></>,
                AlertTriangle: <><path d="m10.29 3.86 7.92 13.17c.75 1.25.21 2.97-1.18 2.97H2.97c-1.39 0-1.93-1.72-1.18-2.97l7.92-13.17a1.996 1.996 0 0 1 3.58 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></>,
                Sparkles: <path d="m12 3 1.912 5.813a2 2 0 0 0 1.275 1.275L21 12l-5.813 1.912a2 2 0 0 0-1.275 1.275L12 21l-1.912-5.813a2 2 0 0 0-1.275-1.275L3 12l5.813-1.912a2 2 0 0 0 1.275-1.275L12 3Z" />,
                Wind: <path d="M9.59 4.59A2 2 0 1 1 11 8H2m10.59 11.41A2 2 0 1 0 14 16H2m15.73-8.27A2.5 2.5 0 1 1 19.5 12H2" />,
                Download: <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3" />,
                Globe: <><circle cx="12" cy="12" r="10"/><line x1="2" x2="22" y1="12" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></>,
                Eye: <><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></>,
                EyeOff: <><path d="M9.88 9.88a3 3 0 1 0 4.24 4.24"/><path d="M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68"/><path d="M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61"/><line x1="2" x2="22" y1="2" y2="22"/></>,
                ClipboardList: <><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><path d="M9 12h6"/><path d="M9 16h6"/><path d="M9 8h6"/></>
            };
            return icons[name] ? <Svg {...props}>{icons[name]}</Svg> : null;
        };

        // --- SUB-COMPONENTS ---
        const ConfirmModal = ({ isOpen, title, message, onConfirm, onCancel, isDarkMode }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-[110] flex items-center justify-center p-6 bg-slate-900/20 backdrop-blur-md animate-in">
                    <div className={`w-full max-w-sm rounded-[3rem] p-10 shadow-2xl border ${isDarkMode ? 'bg-slate-900 border-white/10 text-white' : 'bg-white border-white/60 text-slate-900'}`}>
                        <div className="w-20 h-20 bg-rose-50 rounded-full flex items-center justify-center mx-auto mb-8 animate-bounce"><Icon name="AlertTriangle" className="text-rose-400" size={40} /></div>
                        <h3 className="text-2xl font-bold mb-3 tracking-tight">{title}</h3>
                        <p className="text-sm text-slate-500 mb-10 leading-relaxed">{message}</p>
                        <div className="flex flex-col gap-3">
                            <button onClick={onConfirm} className="py-5 rounded-[1.5rem] bg-slate-900 text-white font-bold shadow-xl active:scale-95 transition-transform">Ya, Lanjut</button>
                            <button onClick={onCancel} className="py-4 text-slate-400 font-medium hover:text-slate-600">Batal</button>
                        </div>
                    </div>
                </div>
            );
        };

        const TodoItem = ({ t, onToggle, onDelete, isDarkMode, index, onDragStart, onDragOver, onDragEnd, isDragging }) => (
            <div draggable onDragStart={(e) => onDragStart(e, index)} onDragOver={(e) => onDragOver(e, index)} onDragEnd={onDragEnd} className={`group relative mb-4 rounded-[2rem] transition-all duration-300 border flex items-center gap-4 p-5 cursor-pointer ${isDragging ? 'opacity-30 scale-95 border-teal-500 dashed' : ''} ${t.done ? 'bg-teal-500/10 border-teal-200 opacity-60' : (isDarkMode ? 'bg-slate-800 border-white/5' : 'bg-white/80 border-white shadow-sm hover:shadow-md')} hover:scale-[1.01]`}>
                <div className="text-slate-300 cursor-grab active:cursor-grabbing hover:text-teal-500 p-1"><Icon name="GripVertical" size={20} /></div>
                <div className="flex-1 flex items-center gap-4" onClick={() => onToggle(t.id)}>
                    <div className={`w-12 h-12 rounded-2xl flex items-center justify-center border-2 transition-all shrink-0 ${t.done ? 'bg-teal-600 border-teal-600 text-white shadow-lg' : (isDarkMode ? 'border-slate-600' : 'border-slate-200 bg-slate-50/50')}`}>{t.done && <Icon name="CheckCircle" size={24} />}</div>
                    <span className={`font-semibold text-base tracking-tight text-left flex-1 ${t.done ? 'line-through opacity-40 text-slate-400' : (isDarkMode ? 'text-white' : 'text-slate-700')}`}>{t.text}</span>
                </div>
                <button className="p-3 text-slate-300 hover:text-rose-400 opacity-0 group-hover:opacity-100 transition-opacity" onClick={(e) => { e.stopPropagation(); onDelete(t.id); }}><Icon name="Trash2" size={18} /></button>
            </div>
        );

        const DigitalClock = ({ time }) => <span className="tabular-nums font-bold tracking-tighter text-3xl">{time.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit', second: '2-digit' })}</span>;

        // --- MAIN APP ---
        function App() {
            const STORAGE_KEY = "temanqu_v42_final_secured";
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [loginInputUser, setLoginInputUser] = useState("");
            const [loginInputPass, setLoginInputPass] = useState("");
            const [loginError, setLoginError] = useState("");
            const [currentUserIdx, setCurrentUserIdx] = useState(0);
            const [activeTab, setActiveTab] = useState('home');
            const [isDarkMode, setIsDarkMode] = useState(false);
            const [showNav, setShowNav] = useState(true);
            const [lastScrollY, setLastScrollY] = useState(0);
            const [langInput, setLangInput] = useState("");
            const [selectedLang, setSelectedLang] = useState("ar");
            const [langResult, setLangResult] = useState("");
            const [showToken, setShowToken] = useState(false);

            const [accounts, setAccounts] = useState(() => {
                const saved = localStorage.getItem(STORAGE_KEY);
                try { return saved ? JSON.parse(saved) : [{ username: 'admin', password: '123', displayName: 'Hamba Allah', city: 'Jakarta', todos: [], recovery: [], githubToken: "" }]; } 
                catch { return [{ username: 'admin', password: '123', displayName: 'Hamba Allah', city: 'Jakarta', todos: [], recovery: [], githubToken: "" }]; }
            });

            // Initialize profileForm without 'gasUrl'
            const [profileForm, setProfileForm] = useState({ displayName: '', city: '', githubToken: '', username: '', password: '' });
            const [prayerTimes, setPrayerTimes] = useState(null);
            const [hijriDate, setHijriDate] = useState("");
            const [locationInfo, setLocationInfo] = useState("Jakarta");
            const [currentTime, setCurrentTime] = useState(new Date());
            const [isLoading, setIsLoading] = useState(false);
            const [healingResult, setHealingResult] = useState("");
            const [journalResult, setJournalResult] = useState("");
            const [journalInput, setJournalInput] = useState({ surah: '', ayat: '' });
            const [surahSearch, setSurahSearch] = useState("");
            const [wisdomPill, setWisdomPill] = useState("");
            const [curhatInput, setCurhatInput] = useState("");
            const [isProfileLocked, setIsProfileLocked] = useState(true);
            const [saveStatus, setSaveStatus] = useState("");
            const [confirmDeleteData, setConfirmDeleteData] = useState({ isOpen: false, id: null, type: null, title: '', message: '' });
            const [draggedIndex, setDraggedIndex] = useState(null);

            const healingRef = useRef(null);
            const journalRef = useRef(null);
            const langRef = useRef(null);

            const user = accounts[currentUserIdx] || {};

            const SURAHS_LIST = ["Al-Fatihah", "Al-Baqarah", "Ali 'Imran", "An-Nisa'", "Al-Ma'idah", "Al-An'am", "Al-A'raf", "An-Anfal", "At-Tawbah", "Yunus", "Hud", "Yusuf", "Ar-Ra'd", "Ibrahim", "Al-Hijr", "An-Nahl", "Al-Isra'", "Al-Kahf", "Maryam", "Ta-Ha", "Al-Anbiya'", "Al-Hajj", "Al-Mu'minun", "An-Nur", "Al-Furqan", "Ash-Shu'ara'", "An-Naml", "Al-Qasas", "Al-'Ankabut", "Ar-Rum", "Luqman", "As-Sajdah", "Al-Ahzab", "Saba'", "Fatir", "Ya-Sin", "As-Saffat", "Sad", "Az-Zumar", "Ghafir", "Fussilat", "Ash-Shura", "Az-Zukhruf", "Ad-Dukhan", "Al-Jathiyah", "Al-Ahqaf", "Muhammad", "Al-Fath", "Al-Hujurat", "Qaf", "Adh-Dhariyat", "At-Tur", "An-Najm", "Al-Qamar", "Ar-Rahman", "Al-Waqi'ah", "Al-Hadid", "Al-Mujadilah", "Al-Hashr", "Al-Mumtahanah", "As-Saff", "Al-Jumu'ah", "Al-Munafiqun", "At-Taghabun", "At-Talaq", "At-Tahrim", "Al-Mulk", "Al-Qalam", "Al-Haqqah", "Al-Ma'arij", "Nuh", "Al-Jinn", "Al-Muzzammil", "Al-Muddaththir", "Al-Qiyamah", "Al-Insan", "Al-Mursalat", "An-Naba'", "An-Nazi'at", "'Abasa", "At-Takwir", "Al-Infitar", "Al-Mutaffifin", "Al-Inshiqaq", "Al-Buruj", "At-Tariq", "Al-A'la", "Al-Ghashiyah", "Al-Fajr", "Al-Balad", "Ash-Shams", "Al-Layl", "Ad-Duha", "Ash-Sharh", "At-Tin", "Al-'Alaq", "Al-Qadr", "Al-Bayyinah", "Az-Zalzalah", "Al-'Adiyat", "Al-Qari'ah", "At-Takathur", "Al-'Asr", "Al-Humazah", "Al-Fil", "Quraysh", "Al-Ma'un", "Al-Kawthar", "Al-Kafirun", "An-Nasr", "Al-Masad", "Al-Ikhlas", "Al-Falaq", "An-Nas"];
            const RECOVERY_ADVICES_200 = [
                "Allah melihatmu, Kak. Jangan biarkan Dia melihatmu bermaksiat di balik pintu yang terkunci.",
                "Satu klik salah bisa menghancurkan benteng pertahanan yang sudah kamu bangun berhari-hari.",
                "Ingat wajah Ibu dan Ayah. Maukah kamu mengecewakan harapan dan doa mereka demi kesenangan semu?",
                "Layar HP-mu akan menjadi saksi di hari kiamat. Pastikan ia bersaksi tentang kebaikanmu.",
                "Pikirkan maut. Bagaimana jika malaikat maut datang saat layar itu masih menyala?",
                "Kebahagiaan maksiat itu palsu, ia hanya meninggalkan rasa hampa dan sedih di hatimu.",
                "Hati yang bersih akan merasakan nikmatnya sujud yang lama. Menanglah hari ini!"
            ];
            
            const WISDOM_PILLS_200 = [
                "Mintalah pertolongan kepada Allah dengan sabar dan sholat.",
                "Dan Allah Maha Mengetahui apa yang ada dalam hatimu.",
                "Janganlah kamu berputus asa dari rahmat Allah.",
                "Sesungguhnya Allah mencintai orang-orang yang bertawakal.",
                "Rahmat-Ku meliputi segala sesuatu.",
                "Hati yang tenang adalah kunci kebahagiaan sejati."
            ];

            useEffect(() => {
                const handleScroll = () => {
                    const currentY = window.scrollY;
                    if (currentY < lastScrollY || currentY < 50) setShowNav(true);
                    else setShowNav(false);
                    setLastScrollY(currentY);
                };
                window.addEventListener('scroll', handleScroll);
                return () => window.removeEventListener('scroll', handleScroll);
            }, [lastScrollY]);

            useEffect(() => {
                const timer = setInterval(() => setCurrentTime(new Date()), 1000);
                const session = localStorage.getItem('temanqu_session');
                const savedIdx = localStorage.getItem('temanqu_active_idx');
                if(session === 'true' && savedIdx !== null) {
                    setIsLoggedIn(true);
                    setCurrentUserIdx(parseInt(savedIdx));
                }
                return () => clearInterval(timer);
            }, []);

            useEffect(() => {
                if (user && isLoggedIn) {
                    setProfileForm({ displayName: user.displayName || '', city: user.city || '', githubToken: user.githubToken || '', username: user.username || '', password: user.password || '' });
                    if(!prayerTimes) fetchPrayerByCity(user.city || 'Jakarta');
                }
            }, [currentUserIdx, isLoggedIn, user]);

            useEffect(() => { document.documentElement.classList.toggle('dark', isDarkMode); }, [isDarkMode]);

            const recoveryAdviceIndex = useMemo(() => Math.floor(currentTime.getTime() / (1 * 60 * 1000)) % 7, [currentTime]);
            
            const nextPrayerInfo = useMemo(() => {
                if (!prayerTimes) return null;
                const prayers = ['Fajr', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];
                for (let name of prayers) {
                    const timeStr = prayerTimes[name];
                    if (!timeStr) continue;
                    const [h, m] = timeStr.split(':');
                    const pTime = new Date(currentTime); pTime.setHours(parseInt(h), parseInt(m), 0, 0);
                    if (pTime > currentTime) return { name, time: pTime };
                }
                return { name: 'Fajr', time: new Date(currentTime.getTime() + 86400000) };
            }, [prayerTimes, currentTime]);

            const countdownString = useMemo(() => {
                if (!nextPrayerInfo) return "";
                const diff = nextPrayerInfo.time - currentTime;
                const h = Math.floor(diff / 3600000);
                const m = Math.floor((diff % 3600000) / 60000);
                const s = Math.floor((diff % 60000) / 1000);
                return `${h}j ${m}m ${s}d`;
            }, [currentTime, nextPrayerInfo]);

            const formatRecoveryTime = (start) => {
                const diff = currentTime - start;
                const d = Math.floor(diff / 86400000);
                const h = Math.floor((diff % 86400000) / 3600000);
                const m = Math.floor((diff % 3600000) / 60000);
                const s = Math.floor((diff % 60000) / 1000);
                return { d, h, m, s, full: `${d} Hari, ${h}j : ${m}m : ${s}d` };
            };

            const getStreakMessage = (days) => {
                if (days === 0) return "Perjalanan 1000 mil dimulai dari 1 langkah.";
                if (days === 1) return "MasyaAllah! 24 Jam pertama berhasil ditaklukkan!";
                if (days === 3) return "3 Hari! Kamu semakin kuat melawan hawa nafsu.";
                if (days === 7) return "Satu minggu! Ini adalah pencapaian luar biasa.";
                if (days === 40) return "40 Hari! Kebiasaan baru mulai terbentuk.";
                return `Alhamdulillah, ${days} hari terlewati. Terus berjuang!`;
            };

            const fetchPrayerByCity = (city) => {
                setLocationInfo(city);
                fetch(`https://api.aladhan.com/v1/timingsByCity?city=${encodeURIComponent(city)}&country=Indonesia&method=11`)
                .then(r => r.json()).then(d => { if(d?.data) { setPrayerTimes(d.data.timings); setHijriDate(`${d.data.date.hijri.day} ${d.data.date.hijri.month.en} ${d.data.date.hijri.year} H`); } });
            };
            const fetchPrayerByGPS = () => {
                setLocationInfo("Mencari GPS...");
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition((pos) => {
                        fetch(`https://api.aladhan.com/v1/timings?latitude=${pos.coords.latitude}&longitude=${pos.coords.longitude}&method=11`)
                        .then(r => r.json()).then(d => { if(d?.data) { setPrayerTimes(d.data.timings); setHijriDate(`${d.data.date.hijri.day} ${d.data.date.hijri.month.en} ${d.data.date.hijri.year} H`); setLocationInfo(`${pos.coords.latitude.toFixed(2)}, ${pos.coords.longitude.toFixed(2)}`); } });
                    }, () => fetchPrayerByCity(user.city || "Jakarta"));
                }
            };
            const handleCapture = async (ref, fileName) => {
                if (!ref.current || !window.html2canvas) return;
                setIsLoading(true);
                try {
                    const canvas = await window.html2canvas(ref.current, { backgroundColor: "#FFFBF0", scale: 2, useCORS: true });
                    const link = document.createElement("a");
                    link.href = canvas.toDataURL("image/png");
                    link.download = `TemanQu-${fileName}-${Date.now()}.png`;
                    link.click();
                } catch (e) { console.error(e); }
                finally { setIsLoading(false); }
            };

            const callAI = async (type, data) => {
                const token = (profileForm.githubToken || user.githubToken || "").trim();
                
                if (!token) {
                    const simulated = `[Info] Harap masukkan Token GitHub di menu Profil untuk menggunakan fitur AI.`;
                    if(type === 'journal') setJournalResult(simulated); else if(type === 'language') setLangResult(simulated); else setHealingResult(simulated);
                    return;
                }
                
                setIsLoading(true);
                if(type === 'journal') setJournalResult(""); else if(type === 'language') setLangResult(""); else setHealingResult("");

                let systemPrompt = "";
                let userPrompt = "";

                if (type === 'healing') {
                    systemPrompt = "Anda adalah 'TemanQu', sahabat virtual yang bijak, Islami, hangat. Gunakan bahasa Indonesia santai.";
                    userPrompt = `Pengguna merasa: "${data}". Berikan tanggapan menenangkan, validasi perasaan, nasihat psikologis ringan, dan motivasi spiritual/kutipan Islami.`;
                } else if (type === 'journal') {
                    systemPrompt = "Anda adalah ahli tafsir Al-Qur'an yang puitis. Jawab dalam Bahasa Indonesia.";
                    userPrompt = `Berikan tadabbur singkat untuk Surat ${data.surah} Ayat ${data.ayat}. Jelaskan makna inti dan hikmah praktis.`;
                } else if (type === 'language') {
                    const langName = selectedLang === 'ar' ? 'Bahasa Arab' : 'Bahasa Inggris';
                    systemPrompt = `Anda adalah ahli bahasa ${langName}. Jawab dalam Bahasa Indonesia.`;
                    userPrompt = `Analisis kalimat: "${data}". Cek tata bahasa, koreksi jika salah, dan jelaskan alasannya.`;
                } else if (type === 'recovery') {
                    systemPrompt = "Anda adalah mentor recovery kecanduan yang tegas namun penuh kasih sayang. Jawab dalam Bahasa Indonesia.";
                    userPrompt = `Pengguna berjuang melawan: "${data}". Berikan motivasi kuat cegah relapse.`;
                }

                try {
                    const response = await fetch("https://models.inference.ai.azure.com/chat/completions", {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                        body: JSON.stringify({
                            messages: [
                                { role: "system", content: systemPrompt },
                                { role: "user", content: userPrompt }
                            ],
                            model: "gpt-4o",
                            temperature: 0.7,
                            max_tokens: 800
                        })
                    });

                    if (!response.ok) throw new Error("API Error");
                    const result = await response.json();
                    const clean = result.choices[0].message.content.trim();
                    
                    if(type === 'journal') setJournalResult(clean); else if(type === 'language') setLangResult(clean); else setHealingResult(clean);
                } catch (e) {
                    const errMsg = "[Gagal] Periksa Token GitHub Anda.";
                    if(type === 'language') setLangResult(errMsg); else if(type === 'journal') setJournalResult(errMsg); else setHealingResult(errMsg);
                } finally { setIsLoading(false); }
            };
            
            const handleLogin = (e) => {
                e.preventDefault();
                const idx = accounts.findIndex(a => a.username === loginInputUser && a.password === loginInputPass);
                if (idx !== -1) {
                    setCurrentUserIdx(idx);
                    setIsLoggedIn(true);
                    localStorage.setItem('temanqu_session', 'true');
                    localStorage.setItem('temanqu_active_idx', idx.toString());
                    setLoginError("");
                } else {
                    setLoginError("Kombinasi salah.");
                }
            };

            const handleLogout = () => {
                setConfirmDeleteData({
                    isOpen: true,
                    id: 'logout',
                    type: 'logout',
                    title: 'Ingin beristirahat?',
                    message: 'Kamu akan keluar dari sesi ini.'
                });
            };

            const updateData = (newData) => {
                const updated = [...accounts];
                updated[currentUserIdx] = { ...updated[currentUserIdx], ...newData };
                setAccounts(updated);
                localStorage.setItem(STORAGE_KEY, JSON.stringify(updated));
            };

            const triggerDeleteDeed = (id) => {
                setConfirmDeleteData({
                    isOpen: true,
                    id,
                    type: 'todo',
                    title: 'Hapus Amalan?',
                    message: 'Catatan ini akan dihapus permanen.'
                });
            };

            const handleConfirmAction = () => {
                if (confirmDeleteData.type === 'todo') {
                    updateData({ todos: user.todos.filter(x => x.id !== confirmDeleteData.id) });
                } else if (confirmDeleteData.type === 'logout') {
                    setIsLoggedIn(false);
                    localStorage.removeItem('temanqu_session');
                }
                setConfirmDeleteData({ isOpen: false, id: null, type: null, title: '', message: '' });
            };

            const handleDragStart = (e, index) => {
                setDraggedIndex(index);
                e.dataTransfer.effectAllowed = 'move';
            };

            const handleDragOver = (e, index) => {
                e.preventDefault();
                if (draggedIndex === null || draggedIndex === index) return;
                const currentTodos = [...user.todos];
                const itemToMove = currentTodos[draggedIndex];
                currentTodos.splice(draggedIndex, 1);
                currentTodos.splice(index, 0, itemToMove);
                setDraggedIndex(index);
                updateData({ todos: currentTodos });
            };

            const handleDragEnd = () => {
                setDraggedIndex(null);
            };

            const activeProgress = user.todos?.length > 0 ? Math.round((user.todos.filter(t => t.done).length / user.todos.length) * 100) : 0;
            
            const popWisdom = () => setWisdomPill(WISDOM_PILLS_200[Math.floor(Math.random() * WISDOM_PILLS_200.length)]);

            if (!isLoggedIn) {
                return (
                    <div className="min-h-screen flex items-center justify-center bg-[#E5ECEB] dark:bg-slate-900 p-6">
                        <div className="w-full max-w-sm bg-white/70 backdrop-blur-2xl border border-white p-10 rounded-[3.5rem] shadow-2xl text-center space-y-8 animate-in">
                            <div className="w-24 h-24 bg-teal-600 rounded-[2.5rem] flex items-center justify-center mx-auto shadow-2xl rotate-12"><Icon name="Sparkles" className="text-white" size={48} /></div>
                            <h1 className="text-4xl font-bold text-teal-800 tracking-tight">TemanQu</h1>
                            <form onSubmit={handleLogin} className="space-y-4">
                                <div className="relative group"><Icon name="User" className="absolute left-5 top-1/2 -translate-y-1/2 text-teal-600" size={20}/><input type="text" value={loginInputUser} onChange={e => setLoginInputUser(e.target.value)} className="w-full p-5 pl-14 bg-white/50 border border-white rounded-[1.5rem] outline-none font-semibold" placeholder="Username" required /></div>
                                <div className="relative group"><Icon name="Key" className="absolute left-5 top-1/2 -translate-y-1/2 text-teal-600" size={20}/><input type="password" value={loginInputPass} onChange={e => setLoginInputPass(e.target.value)} className="w-full p-5 pl-14 bg-white/50 border border-white rounded-[1.5rem] outline-none font-semibold" placeholder="Password" required /></div>
                                {loginError && <div className="p-4 bg-rose-50 text-rose-500 rounded-2xl text-xs font-bold animate-pulse">{loginError}</div>}
                                <button type="submit" className="w-full py-5 bg-teal-700 text-white rounded-[1.5rem] font-bold uppercase tracking-widest text-sm shadow-xl active:scale-95 transition-transform">Mulai Perjalanan</button>
                            </form>
                            <div className="opacity-30 font-medium text-[10px] uppercase tracking-widest">Demo: admin / 123</div>
                        </div>
                    </div>
                );
            }

            return (
                <div className={`min-h-screen transition-all duration-700 pb-32 overflow-x-hidden font-sans ${isDarkMode ? 'bg-slate-950 text-slate-100' : 'bg-[#F0F4F3] text-slate-800'}`}>
                    <ConfirmModal isOpen={confirmDeleteData.isOpen} title={confirmDeleteData.title} message={confirmDeleteData.message} onConfirm={handleConfirmAction} onCancel={() => setConfirmDeleteData({ isOpen: false })} isDarkMode={isDarkMode} />
                    <header className="px-6 py-6 max-w-xl mx-auto sticky top-4 z-50"><div className={`rounded-[2.5rem] p-5 flex justify-between items-center shadow-sm backdrop-blur-2xl border-t border-white/40 ${isDarkMode ? 'bg-slate-900/90' : 'bg-white/70'}`}><div className="flex items-center gap-2"><div className="w-10 h-10 bg-teal-600 rounded-2xl flex items-center justify-center text-white rotate-6 shadow-sm"><Icon name="Smile" size={20} /></div><h1 className="text-2xl font-bold tracking-tighter text-teal-900 dark:text-teal-400">TemanQu</h1></div><button onClick={() => setIsDarkMode(!isDarkMode)} className="p-3 bg-teal-600/10 dark:bg-slate-800 text-teal-700 dark:text-teal-400 rounded-2xl active:rotate-45">{isDarkMode ? <Icon name="Sun" size={20} /> : <Icon name="Moon" size={20} />}</button></div></header>

                    <main className="max-w-xl mx-auto px-6 space-y-12 mt-12 animate-in">
                        {activeTab === 'home' && (
                            <div className="space-y-10 text-center">
                                <div><h2 className="text-4xl font-bold mb-3 tracking-tighter">Hai, {user.displayName || 'Sahabat'} ‚ú®</h2><p className="text-sm font-medium opacity-60 uppercase tracking-widest">{hijriDate}</p></div>
                                <div className={`p-10 rounded-[3rem] border shadow-xl ${isDarkMode ? 'bg-slate-900 border-white/5' : 'bg-white/60 border-white'}`}><div className="flex flex-col items-center mb-10 space-y-4 text-center"><div className="p-4 bg-teal-600/10 rounded-3xl text-teal-800 flex items-center gap-2"><Icon name="MapPin" size={16}/> <span className="text-sm font-bold">{locationInfo}</span><button onClick={fetchPrayerByGPS}><Icon name="RefreshCw" size={14} /></button></div><DigitalClock time={currentTime} />{nextPrayerInfo && <div className="px-5 py-3 bg-orange-100/50 text-orange-700 rounded-2xl text-xs font-bold"><Icon name="Timer" size={12} className="inline mr-1" />{countdownString} ke {nextPrayerInfo.name}</div>}</div><div className="grid gap-4">{prayerTimes && ['Fajr', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'].map(p => (<div key={p} className={`flex justify-between p-6 rounded-[2rem] border ${nextPrayerInfo?.name === p ? 'bg-teal-600 text-white' : 'opacity-60 border-white'}`}><span className="font-bold text-xs uppercase">{p}</span><span className="font-bold text-lg">{prayerTimes[p]}</span></div>))}</div></div>
                            </div>
                        )}
                         {activeTab === 'amal' && (
                            <div className="space-y-10"><div className="flex items-center justify-center gap-3 mb-6"><h2 className="text-3xl font-bold tracking-tight">Ceklist Amal</h2><Icon name="ClipboardList" size={28} className="text-teal-600" /></div><div className={`p-12 rounded-[3.5rem] border shadow-xl flex flex-col items-center ${isDarkMode ? 'bg-slate-900 border-white/5' : 'bg-white/60 border-white'}`}><div className="relative flex items-center justify-center mb-10"><svg className="w-48 h-48 transform -rotate-90"><circle cx="96" cy="96" r="88" strokeWidth="16" fill="transparent" className="stroke-slate-200 opacity-30" /><circle cx="96" cy="96" r="88" strokeWidth="16" fill="transparent" strokeDasharray={552.9} strokeDashoffset={552.9 - (552.9 * (activeProgress / 100))} className="stroke-teal-600 transition-all duration-1000 ease-out" strokeLinecap="round" /></svg><span className="absolute text-5xl font-black text-teal-700">{activeProgress}%</span></div><div className="w-full space-y-1">{user.todos?.map((t, idx) => (<TodoItem key={t.id} t={t} index={idx} isDarkMode={isDarkMode} isDragging={draggedIndex === idx} onToggle={(id) => updateData({ todos: user.todos.map(x => x.id === id ? {...x, done: !x.done} : x) })} onDelete={triggerDeleteDeed} onDragStart={handleDragStart} onDragOver={handleDragOver} onDragEnd={() => setDraggedIndex(null)} />))}</div><div className="flex gap-4 mt-12 w-full"><input id="addTodo" className="flex-1 p-6 bg-white/50 dark:bg-slate-800 border border-white rounded-[1.8rem] outline-none font-bold text-sm focus:ring-4 focus:ring-teal-100 transition-all dark:text-white" placeholder="Tulis amalan baru..." /><button onClick={() => { const i = document.getElementById('addTodo'); if(i.value) { updateData({ todos: [...(user.todos || []), { id: Date.now(), text: i.value, done: false }] }); i.value = ""; } }} className="bg-teal-600 text-white w-20 rounded-[1.8rem] flex items-center justify-center shadow-lg"><Icon name="Plus" size={32}/></button></div></div></div>
                        )}
                        {activeTab === 'healing' && (
                            <div className="space-y-12 text-center"><h2 className="text-3xl font-bold">Curhat Dong! üïäÔ∏è</h2><div className={`p-10 rounded-[3rem] border shadow-xl ${isDarkMode ? 'bg-slate-900' : 'bg-white/60'}`}><textarea className="w-full p-8 bg-white/40 dark:bg-slate-800 rounded-[2.5rem] outline-none font-medium text-base min-h-[200px] resize-none focus:ring-4 focus:ring-teal-100 transition-all dark:text-white border border-white" placeholder="Apa yang kamu pikirkan?" value={curhatInput} onChange={(e) => setCurhatInput(e.target.value)} /><button onClick={() => callAI('healing', curhatInput)} disabled={!curhatInput || isLoading} className="w-full bg-teal-900 dark:bg-teal-800 text-white py-6 rounded-[1.8rem] font-bold mt-6 shadow-xl">Bimbing Saya</button></div>{healingResult && (<div ref={healingRef} className="p-12 rounded-[4rem] bg-[#FFFBF0] text-black shadow-2xl border-4 border-white"><div className="prose max-w-none"><p className="text-xl leading-loose text-justify font-handwriting whitespace-pre-wrap">{healingResult}</p></div><button onClick={() => handleCapture(healingRef, 'Wasiat')} className="w-full py-4 bg-slate-900 text-white rounded-[1.5rem] font-bold mt-10 flex items-center justify-center gap-2"><Icon name="Camera" size={18}/> Simpan</button></div>)}<div className="text-center"><button onClick={popWisdom} className="px-10 py-4 bg-slate-100 dark:bg-slate-800 rounded-full font-black text-xs uppercase flex items-center gap-2 mx-auto"><Icon name="RotateCcw" size={16}/> Kapsul Hikmah</button>{wisdomPill && <div className="p-8 bg-emerald-500/10 rounded-[32px] mt-6 italic font-handwriting text-xl text-black">"{wisdomPill}"</div>}</div></div>
                        )}
                         {activeTab === 'bahasa' && (
                            <div className="space-y-12 text-center"><h2 className="text-3xl font-bold">Poles Bahasa ‚úçÔ∏è</h2><div className={`p-10 rounded-[3rem] border shadow-xl ${isDarkMode ? 'bg-slate-900' : 'bg-white/60'}`}><div className="flex gap-4 mb-6 justify-center"><button onClick={() => setSelectedLang('ar')} className={`px-6 py-3 rounded-2xl font-bold text-sm ${selectedLang === 'ar' ? 'bg-teal-600 text-white' : 'bg-slate-100'}`}>Arab</button><button onClick={() => setSelectedLang('en')} className={`px-6 py-3 rounded-2xl font-bold text-sm ${selectedLang === 'en' ? 'bg-teal-600 text-white' : 'bg-slate-100'}`}>Inggris</button></div><textarea className="w-full p-8 bg-white/40 dark:bg-slate-800 rounded-[2.5rem] outline-none font-medium text-base min-h-[150px] resize-none focus:ring-4 focus:ring-teal-100 transition-all dark:text-white border border-white" placeholder="Masukkan kalimat..." value={langInput} onChange={(e) => setLangInput(e.target.value)} /><button onClick={() => callAI('language', langInput)} disabled={!langInput || isLoading} className="w-full bg-slate-800 text-white py-6 rounded-[1.8rem] font-bold mt-6 shadow-xl">Analisis AI</button></div>{langResult && (<div ref={langRef} className="p-12 rounded-[4rem] bg-[#F0FDF4] text-slate-900 shadow-2xl border-4 border-white text-left"><div className="flex items-center gap-2 mb-6 border-b border-teal-100 pb-4 opacity-50"><Icon name="CheckCircle" size={18} className="text-teal-600"/><span className="text-[10px] font-black uppercase tracking-[0.3em]">Hasil</span></div><div className="prose max-w-none"><p className="text-lg leading-relaxed text-justify font-medium whitespace-pre-wrap">{langResult}</p></div><button onClick={() => handleCapture(langRef, 'Bahasa')} className="w-full py-4 bg-teal-800 text-white rounded-[1.5rem] font-bold mt-8 flex items-center justify-center gap-2"><Icon name="Camera" size={18}/> Simpan</button></div>)}</div>
                        )}
                        {activeTab === 'recovery' && (
                          <div className="space-y-10 text-center"><h2 className="text-3xl font-bold">Lawan Candu üå±</h2><div className="p-12 rounded-[3.5rem] bg-orange-100/30 border-2 border-white shadow-xl relative text-left overflow-hidden"><div className="absolute top-0 right-0 p-8 opacity-10"><Icon name="ShieldAlert" size={120} /></div><div className="relative z-10"><div className="flex items-center gap-2 mb-6 opacity-40"><span className="text-[10px] font-black uppercase tracking-[0.2em]">Pengingat</span></div><p className="text-2xl leading-relaxed italic text-slate-700" style={{ fontFamily: "'Patrick Hand', cursive" }}>"{["Ingat tujuanmu!", "Kamu kuat!", "Jangan menyerah!", "Masa depan cerah menanti."][recoveryAdviceIndex % 4]}"</p></div></div>{user.recovery?.map(r => {
                                const recTime = formatRecoveryTime(r.startTime);
                                const streakMsg = getStreakMessage(recTime.d);
                                return (<div key={r.id} className="p-10 rounded-[3.5rem] border shadow-xl text-left bg-white/60"><div className="flex justify-between items-start mb-8"><div><h4 className="text-sm font-bold text-slate-400 uppercase tracking-widest mb-1">Bebas {r.name}:</h4><div className="text-4xl font-black text-slate-800 tracking-tighter">{recTime.full}</div><div className="mt-4 p-4 bg-teal-50 dark:bg-teal-900/20 rounded-2xl text-teal-700 dark:text-teal-400 text-sm font-bold flex items-center gap-2"><Icon name="Sparkles" size={16} /> {streakMsg}</div></div><button onClick={() => updateData({ recovery: user.recovery.filter(x => x.id !== r.id) })} className="p-4 bg-rose-100 text-rose-400 rounded-2xl"><Icon name="Trash2" size={20}/></button></div><button onClick={() => callAI('healing', `Motivasi bebas ${r.name}`)} className="py-5 bg-teal-600/10 text-teal-800 rounded-3xl font-bold text-xs uppercase w-full">Bimbingan</button></div>)
                          })}<div className="flex gap-4"><input id="addRec" className="flex-1 p-6 bg-white/60 border border-white rounded-[2rem] outline-none font-bold text-center" placeholder="Target?" /><button onClick={() => { const i = document.getElementById('addRec'); if(i.value) { updateData({ recovery: [...(user.recovery || []), { id: Date.now(), name: i.value, startTime: Date.now() }] }); i.value = ""; } }} className="bg-teal-700 text-white w-20 rounded-[2rem] flex items-center justify-center shadow-xl"><Icon name="Plus" size={32}/></button></div></div>
                        )}
                        {activeTab === 'journal' && (
                            <div className="space-y-10 text-center"><h2 className="text-3xl font-bold">Renungan Ayat üìî</h2><div className={`p-8 rounded-[3rem] border shadow-xl flex gap-4 ${isDarkMode ? 'bg-slate-900' : 'bg-white/60'}`}><input type="number" placeholder="No" className="w-24 p-5 bg-white/40 dark:bg-slate-800 rounded-[1.5rem] outline-none font-black text-center" value={journalInput.ayat} onChange={e => setJournalInput(p => ({...p, ayat: e.target.value}))} /><input type="text" placeholder="Surat..." className="flex-1 p-5 bg-white/40 dark:bg-slate-800 rounded-[1.5rem] outline-none font-bold" value={surahSearch} onChange={e => setSurahSearch(e.target.value)} /></div>{surahSearch && (<div className="bg-white/80 rounded-[2rem] shadow-2xl max-h-64 overflow-y-auto p-4">{SURAHS_LIST.filter(s => s.toLowerCase().includes(surahSearch.toLowerCase())).map(s => (<button key={s} onClick={() => { setJournalInput(p => ({...p, surah: s})); setSurahSearch(""); callAI('journal', {surah: s, ayat: journalInput.ayat}); }} className="w-full text-left p-4 rounded-2xl font-bold hover:bg-teal-50">{s}</button>))}</div>)}{journalResult && (<div ref={journalRef} className="p-12 rounded-[4rem] bg-[#FFFBF0] text-black shadow-2xl border-4 border-white relative overflow-hidden text-center"><div className="prose max-w-none"><p className="text-xl leading-loose text-justify font-handwriting whitespace-pre-wrap">{journalResult}</p></div><button onClick={() => handleCapture(journalRef, 'Tadabbur')} className="w-full py-5 bg-teal-900 text-white rounded-[1.8rem] font-bold mt-10 flex items-center justify-center gap-3"><Icon name="Download" size={20}/> Simpan</button></div>)}</div>
                        )}
                        {activeTab === 'profil' && (
                            <div className="space-y-10 text-center"><h2 className="text-3xl font-bold">Akun Saya ‚öôÔ∏è</h2><div className="p-12 rounded-[4rem] border bg-white/60 shadow-xl text-left space-y-8"><div className="space-y-2"><label className="text-[10px] font-black opacity-30 uppercase ml-4">Nama</label><input type="text" value={profileForm.displayName} onChange={e => setProfileForm({...profileForm, displayName: e.target.value})} className="w-full p-6 bg-white/40 dark:bg-slate-800 rounded-[1.8rem] outline-none font-bold text-lg dark:text-white border border-white" /></div><div className="space-y-2"><label className="text-[10px] font-black opacity-30 uppercase ml-4">GitHub Token (Wajib)</label><div className="relative"><input type={showToken ? "text" : "password"} value={profileForm.githubToken} onChange={e => setProfileForm({...profileForm, githubToken: e.target.value})} className={`w-full p-6 bg-white/40 dark:bg-slate-800 rounded-[1.8rem] outline-none font-mono text-xs text-teal-600 ${isProfileLocked ? 'opacity-50 cursor-not-allowed' : ''}`} disabled={isProfileLocked} placeholder="ghp_..." /><button onClick={() => setShowToken(!showToken)} className="absolute right-6 top-1/2 -translate-y-1/2 text-slate-400 hover:text-teal-600 p-2"><Icon name={showToken ? "EyeOff" : "Eye"} size={20} /></button></div></div><button onClick={() => { updateData(profileForm); setSaveStatus("Tersimpan!"); setTimeout(() => setSaveStatus(""), 2000); }} className="w-full py-6 bg-teal-700 text-white rounded-[2rem] font-bold shadow-xl">Simpan Data</button>{saveStatus && <p className="text-center font-bold text-teal-600">{saveStatus}</p>}
                                {isProfileLocked ? (<button onClick={() => setIsProfileLocked(false)} className="w-full py-6 bg-slate-800 dark:bg-teal-800 text-white rounded-[2rem] font-bold mt-4">Buka Gembok Profil</button>) : (<button onClick={() => {setIsProfileLocked(true); setProfileForm(user);}} className="w-full py-6 bg-slate-200 text-slate-700 font-bold rounded-[2rem] mt-4">Batal Edit</button>)}
                                <button onClick={handleLogout} className="w-full py-5 text-rose-500 font-bold mt-6">Keluar</button></div></div>
                        )}
                    </main>

                    <nav className={`fixed bottom-8 left-6 right-6 h-24 rounded-[3rem] flex items-center justify-around px-2 z-40 backdrop-blur-2xl shadow-2xl border-t border-white/40 transition-all duration-500 transform ${showNav ? 'translate-y-0 opacity-100' : 'translate-y-32 opacity-0' } ${isDarkMode ? 'bg-slate-900/95' : 'bg-white/80'}`}>
                        {[{ id: 'home', icon: 'Home', label: 'Beranda' }, { id: 'healing', icon: 'Smile', label: 'Healing' }, { id: 'bahasa', icon: 'Globe', label: 'Bahasa' }, { id: 'amal', icon: 'ClipboardList', label: 'Amal' }, { id: 'recovery', icon: 'ShieldCheck', label: 'Bebas' }, { id: 'journal', icon: 'BookOpen', label: 'Jurnal' }, { id: 'profil', icon: 'Settings', label: 'Profil' }].map(t => (
                            <button key={t.id} onClick={() => setActiveTab(t.id)} className={`flex flex-col items-center justify-center transition-all px-2 py-3 rounded-3xl ${activeTab === t.id ? 'bg-teal-600 text-white shadow-lg' : 'text-slate-400'}`}><Icon name={t.icon} size={20} strokeWidth={activeTab === t.id ? 3 : 2} /><span className={`text-[7px] font-black uppercase mt-1.5 transition-opacity ${activeTab === t.id ? 'opacity-100' : 'opacity-0 h-0'}`}>{t.label}</span></button>
                        ))}
                    </nav>

                    {isLoading && (
                        <div className="fixed inset-0 bg-slate-900/60 backdrop-blur-md z-[100] flex items-center justify-center animate-in">
                            <div className="bg-white p-8 rounded-[2rem] text-center shadow-2xl space-y-6 max-w-xs mx-4 border-4 border-teal-100">
                                <div className="w-16 h-16 border-4 border-teal-200 border-t-teal-600 rounded-full animate-spin mx-auto"></div>
                                <div>
                                    <h3 className="font-bold text-teal-800 text-lg mb-2">Sedang Meracik Hikmah...</h3>
                                    <p className="text-slate-500 text-sm font-handwriting text-lg">"Sambil menunggu, dzikir dulu yuk..."</p>
                                    <p className="text-teal-600 text-xs font-bold mt-4 animate-pulse">Subhanallah ‚Ä¢ Alhamdulillah ‚Ä¢ Allahuakbar</p>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
